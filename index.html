<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>E & C Courier Pickup</title>

<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0a3a6a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="E&C Courier">

<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    padding: 20px;
  }

  #installBtn {
    display: none;
    margin-bottom: 16px;
    padding: 10px 16px;
    font-size: 16px;
    cursor: pointer;
  }

  .instructionBanner {
    margin-bottom: 16px;
    font-size: 14px;
    background: #f1f1f1;
    padding: 10px;
    border-radius: 6px;
  }

  .instructionBanner button {
    margin-top: 6px;
    padding: 4px 8px;
    font-size: 12px;
    cursor: pointer;
  }
</style>
</head>

<body>
<h1>E & C Courier Pickup</h1>

<!-- Android / Chrome Install Button -->
<button id="installBtn">Install App</button>

<!-- iOS Instructions -->
<div id="iosHint" class="instructionBanner" style="display:none;">
  Install on iPhone or iPad:<br>
  Tap <strong>Share</strong> → <strong>Add to Home Screen</strong>
</div>

<!-- Mac Safari Instructions (static, always visible) -->
<div id="macHint" class="instructionBanner">
  Install on macOS Safari:<br>
  In the menu bar, click <strong>File → Add to Dock</strong>
  <br><button id="dismissMacHint">Got it</button>
</div>

<form id="pickupForm">
  <label>Name:</label><br>
  <input type="text" name="name" required><br><br>

  <label>Phone:</label><br>
  <input type="text" name="phone" required><br><br>

  <label>Pickup Address:</label><br>
  <textarea name="address" required></textarea><br><br>

  <label>Notes:</label><br>
  <textarea name="notes"></textarea><br><br>

  <button type="submit">Submit Pickup Request</button>
</form>

<p id="thanksMessage" style="display:none;">Thank you! Your request has been sent.</p>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // ---------------- FIREBASE ----------------
  firebase.initializeApp({
    apiKey: "AIzaSyAKmgoXA4m3cRTmxJq4aUyva5SVvFbTNqg",
    authDomain: "eandccourier-36fcc.firebaseapp.com",
    databaseURL: "https://eandccourier-36fcc-default-rtdb.firebaseio.com",
    projectId: "eandccourier-36fcc",
    storageBucket: "eandccourier-36fcc.appspot.com",
    messagingSenderId: "1067680083511",
    appId: "1:1067680083511:web:a8fa46c0621e74aabd19b2"
  });

  const db = firebase.database();

  // ---------------- FORM ----------------
  const form = document.getElementById("pickupForm");
  const thanks = document.getElementById("thanksMessage");

  form.addEventListener("submit", e => {
    e.preventDefault();
    db.ref("pickups").push({
      name: form.name.value,
      phone: form.phone.value,
      address: form.address.value,
      notes: form.notes.value,
      timestamp: Date.now()
    }).then(() => {
      form.style.display = "none";
      thanks.style.display = "block";
    });
  });

  // ---------------- SERVICE WORKER ----------------
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js');
  }

  // ---------------- INSTALL LOGIC ----------------
  const installBtn = document.getElementById("installBtn");
  const iosHint = document.getElementById("iosHint");
  const macHint = document.getElementById("macHint");
  const dismissMacHint = document.getElementById("dismissMacHint");

  let deferredPrompt = null;
  const isStandalone = window.matchMedia('(display-mode: standalone)').matches ||
                       window.navigator.standalone === true;
  const wasInstalled = localStorage.getItem('pwa-installed') === 'true';

  // Android / Chrome install prompt
  window.addEventListener('beforeinstallprompt', e => {
    e.preventDefault();
    deferredPrompt = e;
    if (!isStandalone && !wasInstalled) installBtn.style.display = 'inline-block';
  });

  installBtn.addEventListener('click', async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    const result = await deferredPrompt.userChoice;
    if (result.outcome === 'accepted') {
      localStorage.setItem('pwa-installed', 'true');
      installBtn.style.display = 'none';
    }
    deferredPrompt = null;
  });

  window.addEventListener('appinstalled', () => {
    localStorage.setItem('pwa-installed', 'true');
    installBtn.style.display = 'none';
    iosHint.style.display = 'none';
    macHint.style.display = 'none';
  });

  // iOS instructions
  if (!isStandalone && !wasInstalled && /iphone|ipad|ipod/i.test(navigator.userAgent)) {
    iosHint.style.display = 'block';
  }

  // Mac dismiss button
  dismissMacHint.addEventListener('click', () => {
    macHint.style.display = 'none';
  });

  // Hide all install UI if app already installed
  if (isStandalone || wasInstalled) {
    installBtn.style.display = 'none';
    iosHint.style.display = 'none';
    macHint.style.display = 'none';
  }
</script>
</body>
</html>
